#!/usr/bin/env bash
#
# Based on https://packagecloud.io/slacktechnologies/slack/install#manual-deb
#
#author      :Tomas Skalicky <skalicky.tomas@gmail.com>
#===============================================================================

#-------------------------------------------------------------------------------

slack_prerequisity_packages_to_install=(
    apt-transport-https
    debian-archive-keyring
    gnupg
)

#-------------------------------------------------------------------------------

install_slack_prerequisity_packages() {
    aptget_install "${slack_prerequisity_packages_to_install[@]}"
}

#-------------------------------------------------------------------------------

configure_slack_apt_sources() {
    local -r keyring_file_name=slacktechnologies_slack-archive-keyring.gpg
    local -r keyring_file_path=${keyrings_home:?}/$keyring_file_name
    #~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    local file_contents
    set +e
    read -r -d '' file_contents <<- EOF
	# Generated by Tomas' setup scripts.
	deb   [signed-by=$keyring_file_path]   https://packagecloud.io/slacktechnologies/slack/debian/   jessie   main
	EOF
    set -e
    set_file_contents \
                      /etc/apt/sources.list.d/slacktechnologies_slack.list \
                      "$file_contents"
    #~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    aptkey_add https://packagecloud.io/slacktechnologies/slack/gpgkey "$keyring_file_name"
}

#-------------------------------------------------------------------------------

slack_packages_to_install=(
    slack-desktop
)

#-------------------------------------------------------------------------------

install_slack() {
    aptget_update
    aptget_install "${slack_packages_to_install[@]}"
}

#-------------------------------------------------------------------------------

main() {
    install_slack_prerequisity_packages
    configure_slack_apt_sources
    install_slack
}

#-------------------------------------------------------------------------------

main

